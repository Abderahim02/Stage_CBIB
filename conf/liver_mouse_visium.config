params {
  // define ref_type as inVivo, exVivo, nuclei
  ref_type = false
  sc_input = (params.ref_type ? "/data/gent/vo/000/gvo00070/vsc43831/rds/liver_mouseStSt${params.ext}*.rds" :
                                "/data/gent/vo/000/gvo00070/vsc43831/rds/liver_mouseStSt_guilliams2022.rds")
  sp_input = "/data/gent/vo/000/gvo00070/vsc43831/rds/liver_mouseVisium_JB0*.rds"
  annot = "annot"
  sampleID = "sample"
  verbose = true
  skip_metrics = true
  deconv_args = [cell2location: [build: "-t digest", fit:""],
                 stereoscope: "-hvg 5000 -sub 250",
                 spotlight: "--conserve.memory TRUE --logfc.threshold 1 --min.pct 0.9 --cl_n 50 --min_cont 0.09",
                 destvi: [build: "-e 5000", fit: "-e 5000 -b 64"],
                 music: "--pct 0.05"]
  // add extension to name if we're using other annotations
  ext = (params.ref_type ? "_${params.ref_type}" : "")
  runID_props = (params.annot ==~ /^annot$/ ? params.ext : "${params.ext}_${params.annot}")
}

process {
  withName: buildStereoscopeModel {
      memory = "96 GB"
      time = "48h"
  }
  withName: fitStereoscopeModel {
      memory = "96 GB"
      time = "20h"
  }

  withName: convert_sc {
      memory = "16 GB"
  }

  withName: convert_sp {
      memory = "2 GB"
  }

  withName: buildCell2locationModel {
      memory = { "${16 + (task.attempt * 16)} GB" }
      time = { "${task.attempt * 4}h" }
  }

  withName: fitCell2locationModel {
      memory = { "${16 + (task.attempt * 16)} GB" }
      time = { "${task.attempt * 4}h" }
  }

  withName: runMusic {
      memory = "48 GB"
      time = "2h"
  }

  withName: runNNLS {
      memory = "48 GB"
      time = "2h"
  }

  withName: runRCTD {
      memory = "48 GB"
      cpus = 4
      time = "8h"
  }

  withName: runSpatialDWLS {
      memory = { "${32 + (task.attempt * 32)} GB" }
      time = "8h"
  }

  withName: runSpotlight {
      memory = { "${32 + (task.attempt * 32)} GB" }
      time = "48h"
  }

  withName: buildDestVIModel {
      memory = { "${16 + (task.attempt * 16)} GB" }
      time = { "${task.attempt * 4}h" }
  }

  withName: fitDestVIModel {
      memory = { "${16 + (task.attempt * 16)} GB" }
      time = { "${task.attempt * 4}h" }
  }

  withName: runTangram {
      memory = { "${16 + (task.attempt * 16)} GB" }
      time = { "${task.attempt * 4}h" }
  }
}